{"createdAt":"2025-04-08T08:03:55.172Z","updatedAt":"2025-04-20T03:51:04.027Z","id":"2Gyv0441tPL8lQXB","name":"vvAgentAssistant","active":true,"nodes":[{"parameters":{"updates":["message"],"additionalFields":{}},"id":"1cae49ec-d9ae-43bf-aff5-efff4690346a","name":"Telegram Trigger","type":"n8n-nodes-base.telegramTrigger","typeVersion":1.1,"position":[400,800],"webhookId":"a0083043-041b-4281-a522-66b47edb4d3e","credentials":{"telegramApi":{"id":"nh94clB91AM5F9q0","name":"vvAgentAssistantBot"}}},{"parameters":{"assignments":{"assignments":[{"id":"fe7ecc99-e1e8-4a5e-bdd6-6fce9757b234","name":"text","value":"={{ $json.message.text }}","type":"string"}]},"options":{}},"id":"ecb9eb9e-402b-4723-8fe0-a383ec7c169e","name":"Set 'Text'","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[920,820]},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.message.chat.id }}","text":"={{ $json.output }}","additionalFields":{"appendAttribution":false}},"id":"c11ff9bd-33ec-44c7-9682-c7b5b1df927b","name":"Response","type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[1720,640],"webhookId":"87147c2e-0914-4339-b2db-346df353bc72","credentials":{"telegramApi":{"id":"nh94clB91AM5F9q0","name":"vvAgentAssistantBot"}}},{"parameters":{"resource":"file","fileId":"={{ $json.message.voice.file_id }}"},"id":"27a60792-a356-4ae0-9ee0-3ee79f3efe35","name":"Download File","type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[900,540],"webhookId":"d62534f5-2dbe-49a4-ad6b-1544f5918d9c","credentials":{"telegramApi":{"id":"nh94clB91AM5F9q0","name":"vvAgentAssistantBot"}}},{"parameters":{"options":{}},"id":"d20d7e4a-1ecc-4a6f-8415-ba7f487f7d3b","name":"OpenAI Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[1040,980],"credentials":{"openAiApi":{"id":"PeTtyI7eZUxZ6b8n","name":"vvAgentAssistant"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ Math.floor(Date.now() / 1000 / 120) }}"},"id":"53266472-3c62-4f4b-a7f1-60dc396ae5a2","name":"Window Buffer Memory1","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.2,"position":[1180,980]},{"parameters":{"name":"CalendarAgent","workflowId":{"__rl":true,"value":"edFOmvERlob2ITh5","mode":"list","cachedResultName":"vvAgentAssistentCalender"}},"id":"c5dcd495-be9d-42a6-80a4-9252868e9823","name":"Calendar agent","type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.2,"position":[1860,980]},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[1320,980],"id":"1f99a3c7-ac9f-439c-9291-5f4113fa04c0","name":"Calculator"},{"parameters":{"name":"Email","workflowId":{"__rl":true,"value":"7kBMLmmuyOuBYcoB","mode":"list","cachedResultName":"vvAgentAssistantMail"}},"id":"5dc085ef-bd08-442d-bb2e-9c242204b534","name":"Email agent","type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.2,"position":[1600,980]},{"parameters":{"name":"Contact","workflowId":{"__rl":true,"value":"eIHDXo58P0pn8JYy","mode":"list","cachedResultName":"vvAgentAssistentContact"}},"id":"c2a5746f-f9a3-40c1-adcc-b9ecfce1f46f","name":"Contact agent","type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.2,"position":[1720,980]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.message.voice.file_id }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Voice"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8c844924-b2ed-48b0-935c-c66a8fd0c778","leftValue":"={{ $json.message.text }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Text"}]},"options":{}},"id":"6037e53f-f8f5-425d-a1ec-758e555c9b50","name":"Switch","type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[640,800]},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"id":"52eec0ff-1969-4a62-a6ba-57dccd516cb6","name":"Transcribe","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.6,"position":[1060,540],"credentials":{"openAiApi":{"id":"PeTtyI7eZUxZ6b8n","name":"vvAgentAssistant"}}},{"parameters":{"name":"TASK","workflowId":{"__rl":true,"value":"AcHpoJrphLjEJAkM","mode":"list","cachedResultName":"vvAgentAssistantTask"},"responsePropertyName":"=response"},"id":"2569154f-1bd5-45d6-b3a5-fb1e09eb2fad","name":"Task agent","type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.2,"position":[1460,980]},{"parameters":{"promptType":"define","text":"={{ $json.text }}","options":{"systemMessage":"=# Overview\nYou are the ultimate personal assistant. Your job is to send the user's query to the correct tool. You should never be writing emails, or creating even summaries, you just need to call the correct tool. \n\n## Tools\n- emailAgent: Use this tool to take action in email\n- calendarAgent: Use this tool to take action in calendar\n- contactAgent: Use this tool to get, search, update, or add contacts\n- taskAgent: Use this tool to get, create, update tasks\n\n## Rules\n- For work with contact: the user will write natural language requests like “найди контакт Ирина Любимка” or “обнови контакт John Doe и добавь email john@example.com”. You need to pass this request to the agent in its pure form, as it came.\n\n- Some actions require you to look up contact information first. For the following actions, you must get contact information and send that to the agent who needs it:\n  - sending emails\n  - drafting emails\n  - creating calendar event with attendee. If you don't find a contact, then continue the action in the calendar event format without attendees, but for the event title/subject use the information provided by the user in the request (i.e. just the name of who to book an appointment with) - in this case, email related actions are ignored (since the email is not specified, there is no need to specify it or perform any actions with it).\n  - when **creating a task** that includes an assignee:\n    1. Use contactAgent to resolve the assignee’s contact (by name). If the specified contact is not found, do not continue - this is an error.\n    2. Call taskAgent to create the task.\n  - when **updating a task**:\n    1. Use taskAgent to retrieve the task by its number or description.\n    2. If the task has an assignee, use contactAgent to resolve their contact (by name).\n    3. Call taskAgent to update the task.\n\n\n## Examples\n1) \n- Input: send an email to tom crocodile asking him what time he wants to leave\n  - Action: Use contactAgent to get tom crocodile's email\n  - Action: Use emailAgent to send the email. You will pass the tool a query like \"send tom crocodile an email to ask what time he wants to leave. here is his email: [email address]\n- Output: The email has been sent to Tom Crocodile. Anything else I can help you with?\n2) \n- Input: make an appointment with tom in calendar.\n  - Action: Use contactAgent to get tom's info (name and emai). If contact not found - continue without email.\n  - Action: Use calendarAgent to to set up a meeting. If the email is specified, then use create a meeting with the participant, if not - just a meeting, specifying the name in the subject.\n- Output: The meeting was scheduled. Anything else I can help you with?\n3)\n- Input: create a task for prepare slides for John.\n  - Action: Use contactAgent to get John’s contact\n  - Action: Use taskAgent to create a task for prepare slides, John’s contact name as assignee\n  - Output: The task with number 1 has been added for John. Anything else I can help you with?\n4)\n- Input: find contact - John.\n  - Action: Use contactAgent to get John’s contact. Send - find John's contact.\n  - Output: John's contact. Anything else I can help you with?\n\n## Final Reminders\n- Here is the current date/time: {{ $now }}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[1240,640],"id":"1865ff38-fa5c-43f5-b706-c6662329a5b6","name":"БИЗНЕС АССИСТЕНТ"}],"connections":{"Telegram Trigger":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Set 'Text'":{"main":[[{"node":"БИЗНЕС АССИСТЕНТ","type":"main","index":0}]]},"Download File":{"main":[[{"node":"Transcribe","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"БИЗНЕС АССИСТЕНТ","type":"ai_languageModel","index":0}]]},"Window Buffer Memory1":{"ai_memory":[[{"node":"БИЗНЕС АССИСТЕНТ","type":"ai_memory","index":0}]]},"Calendar agent":{"ai_tool":[[{"node":"БИЗНЕС АССИСТЕНТ","type":"ai_tool","index":0}]]},"Calculator":{"ai_tool":[[{"node":"БИЗНЕС АССИСТЕНТ","type":"ai_tool","index":0}]]},"Email agent":{"ai_tool":[[{"node":"БИЗНЕС АССИСТЕНТ","type":"ai_tool","index":0}]]},"Contact agent":{"ai_tool":[[{"node":"БИЗНЕС АССИСТЕНТ","type":"ai_tool","index":0}]]},"Switch":{"main":[[{"node":"Download File","type":"main","index":0}],[{"node":"Set 'Text'","type":"main","index":0}]]},"Transcribe":{"main":[[{"node":"БИЗНЕС АССИСТЕНТ","type":"main","index":0}]]},"Task agent":{"ai_tool":[[{"node":"БИЗНЕС АССИСТЕНТ","type":"ai_tool","index":0}]]},"БИЗНЕС АССИСТЕНТ":{"main":[[{"node":"Response","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"58742b14-8f95-4d0e-a900-571e0292cafb","triggerCount":1,"tags":[{"createdAt":"2025-04-08T08:03:46.944Z","updatedAt":"2025-04-08T08:03:46.944Z","id":"9GK9TGGZgfmsCFnI","name":"vv"}]}