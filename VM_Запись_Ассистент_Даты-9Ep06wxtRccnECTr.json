{"createdAt":"2025-07-27T11:36:35.711Z","updatedAt":"2025-07-27T23:32:44.000Z","id":"9Ep06wxtRccnECTr","name":"VM_–ó–∞–ø–∏—Å—å_–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç_–î–∞—Ç—ã","active":false,"isArchived":false,"nodes":[{"parameters":{"options":{"responseFormat":"json_object","temperature":0.1}},"id":"4fb8ae54-7500-4ae8-9b61-e2d6d8afefa3","name":"OpenAI chat model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[1040,560],"credentials":{"openAiApi":{"id":"GNF43Sew2wDttbmY","name":"OpenAi VV"}}},{"parameters":{"resource":"databasePage","operation":"getAll","databaseId":{"__rl":true,"value":"23657ae1-e71a-8091-8925-c2337b9b7232","mode":"list","cachedResultName":"–ó–∞–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç–æ–≤","cachedResultUrl":"https://www.notion.so/23657ae1e71a80918925c2337b9b7232"},"returnAll":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}","simple":false,"filterType":"manual","matchType":"allFilters","filters":{"conditions":[{"key":"–î–∞—Ç–∞ –≤–∏–∑–∏—Ç–∞|date","condition":"on_or_after","date":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Date', ``, 'string') }}"},{"key":"–î–∞—Ç–∞ –≤–∏–∑–∏—Ç–∞|date","condition":"before","date":"={{ DateTime.fromISO($fromAI('conditions0_Date', ``, 'string')).setZone('Europe/Moscow').plus(1, 'days') }}"}]},"options":{}},"type":"n8n-nodes-base.notionTool","typeVersion":2.2,"position":[1380,560],"id":"da033822-8a6c-4866-a3df-3d04950a2ea6","name":"Get notion appointments","credentials":{"notionApi":{"id":"09WDFf4vp7iD93dG","name":"Notion account VM "}}},{"parameters":{"promptType":"define","text":"=–î–∞—Ç–∞: {{ $('Another workflow trigger').item.json.inputDate }}\nID –∫–æ–Ω—Ç–∞–∫—Ç–∞ –≤ Notion: {{ $('Another workflow trigger').item.json.clientId }}\n–î–µ–π—Å—Ç–≤–∏–µ: {{ $('Another workflow trigger').item.json.actionType }}","options":{"systemMessage":"=üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:  \n–¢—ã ‚Äî –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –∞–≥–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ–º–æ—â–Ω–∏—Ü—ã (–ê–Ω–∞—Å—Ç–∞—Å–∏–∏) –¥–∞–Ω–Ω—ã–µ, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ:\n- –ª–∏–±–æ —É–∫–∞–∑–∞–Ω–∏–µ –¥–∞—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: ¬´–≤ –ø—è—Ç–Ω–∏—Ü—É¬ª, ¬´–∑–∞–≤—Ç—Ä–∞¬ª, ¬´21 –∏—é–ª—è¬ª, ¬´–Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö¬ª),\n- –ª–∏–±–æ –≤–æ–ø—Ä–æ—Å –æ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –ø—Ä–∏—ë–º–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: ¬´—á–µ—Ä–µ–∑ —Å–∫–æ–ª—å–∫–æ —É –º–µ–Ω—è –ø—Ä–∏—ë–º?¬ª).\n- –ª–∏–±–æ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ –¥–ª—è –æ—Ç–º–µ–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: ¬´25 –∏—é–ª—è –≤ 15:00¬ª).\n\n–ò –¥–∞–ª–µ–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–∞–∫–æ–π-—Ç–æ —Å—Ü–µ–Ω–∞—Ä–∏–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–µ–π—Å—Ç–≤–∏—è.\n\n‚ö†Ô∏è–¢—ã **–Ω–µ –æ–±—â–∞–µ—à—å—Å—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º**, —Ç–æ–ª—å–∫–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—à—å JSON —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º.\n\nüîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:\n- `Get time to date` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—à–µ–¥—à–µ–π –¥–∞—Ç—ã.\n- `Get notion appointments` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É.\n- `Get client notion appointments` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ `clientId` (–¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –ø—Ä–∏—ë–º–∞).\n- `Check notion appointment` ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏ –µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏ –ø–æ –¥–∞—Ç–µ.\n\nüì• –í—Ö–æ–¥:\n- –î–∞—Ç–∞ ‚Äî inputDate - —Å—Ç—Ä–æ–∫–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ¬´–≤ –ø—è—Ç–Ω–∏—Ü—É¬ª, ¬´–∑–∞–≤—Ç—Ä–∞¬ª, ¬´21 –∏—é–ª—è¬ª, ¬´21.07¬ª, ¬´–Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö¬ª, ¬´—Å–µ–≥–æ–¥–Ω—è¬ª –∏ —Ç.–ø.\n- ID –∫–æ–Ω—Ç–∞–∫—Ç–∞ –≤ Notion - clientId - –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.\n- –î–µ–π—Å—Ç–≤–∏–µ - actionType - —Å—Ç—Ä–æ–∫–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –¥–µ–π—Å—Ç–∏–≤–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ —Å–æ–≤–µ—Ä—à–∏—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä: 'make appointment' –∏–ª–∏ –¥—Ä—É–≥–æ–µ.\n\nüìç –®–∞–≥ 0 ‚Äî –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è\n- –ï—Å–ª–∏ actionType = \"get time until appointment\" –∏ clientId –Ω–µ –ø—É—Å—Ç–æ–π ‚Äî –≤—ã–ø–æ–ª–Ω—è–π —Å—Ü–µ–Ω–∞—Ä–∏–π A (—Ä–∞—Å—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –ø—Ä–∏—ë–º–∞).\n- –ï—Å–ª–∏ actionType = \"make appointment\", —Ç–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–π —Å—Ü–µ–Ω–∞—Ä–∏–π B (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ª–æ—Ç–æ–≤).\n- –ï—Å–ª–∏ actionType = \"check appointment for cancellation\", —Ç–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–π —Å—Ü–µ–Ω–∞—Ä–∏–π C (–ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è).\n‚ö†Ô∏è –ù–µ –ø–µ—Ä–µ–ø—É—Ç–∞–π –¥–µ–π—Å—Ç–≤–∏—è. –°—Ü–µ–Ω–∞—Ä–∏–∏ —Å—Ç—Ä–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ø–æ–ª—é `actionType`. –ù–µ –ø—ã—Ç–∞–π—Å—è —Å–∞–º –≤—ã–±–∏—Ä–∞—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π ‚Äî —Å–ª–µ–¥—É–π —É—Å–ª–æ–≤–∏—è–º –≤—ã—à–µ.\n\n\n‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π A ‚Äî –†–∞—Å—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ –ø—Ä–∏—ë–º–∞ –∫–ª–∏–µ–Ω—Ç–∞\n1. –ò—Å–ø–æ–ª—å–∑—É–π `Get client notion appointments`, –ø–µ—Ä–µ–¥–∞–π —Ç—É–¥–∞ clientId.\n2. –û—Ç—Ñ–∏–ª—å—Ç—Ä—É–π —Ç–æ–ª—å–∫–æ –±—É–¥—É—â–∏–µ –∑–∞–ø–∏—Å–∏ (—Ç.–µ. –±–æ–ª—å—à–µ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã {{ $now.setZone('Europe/Moscow') }}).\n3. –ù–∞–π–¥–∏ –±–ª–∏–∂–∞–π—à—É—é –∑–∞–ø–∏—Å—å.\n4. –ü–µ—Ä–µ–¥–∞–π –Ω–∞–π–¥–µ–Ω–Ω—É—é –¥–∞—Ç—É –≤ `Get time to date` –≤ —Ñ–æ—Ä–º–∞—Ç–µ: 2025-07-22T00:00:00.000+03:00.\n5. –í–µ—Ä–Ω–∏:\n{\n  \"status\": \"ok\",\n  \"next_appointment\": \"2025-07-28T15:00:00+03:00\",\n  \"time_until\": \"1 –¥–µ–Ω—å 4 —á–∞—Å–∞ 15 –º–∏–Ω—É—Ç\"\n}\n–ï—Å–ª–∏ –∑–∞–ø–∏—Å–µ–π –Ω–µ—Ç ‚Äî –≤–µ—Ä–Ω–∏:\n{\n  \"status\": \"error\",\n  \"message\": \"–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π üòå –í—ã –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å —É–¥–æ–±–Ω—É—é –¥–∞—Ç—É, –∏ —è –≤—Å—ë –æ—Ä–≥–∞–Ω–∏–∑—É—é!\"\n}\n\n\n‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π B ‚Äî –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –∏ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–ª–æ—Ç–æ–≤:\nüìç –®–∞–≥ 1 - –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –¥–∞—Ç—ã\n–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π —Ñ–æ—Ä–º–∞—Ç—ã:\n   - ¬´–∑–∞–≤—Ç—Ä–∞¬ª ‚Äî {{ $now.setZone('Europe/Moscow').plus(1, 'days') }}. ¬´–ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞¬ª - {{ $now.setZone('Europe/Moscow').plus(2, 'days') }}  –∏–ª–∏ ¬´—á–µ—Ä–µ–∑ 3 –¥–Ω—è¬ª - {{ $now.setZone('Europe/Moscow').plus(3, 'days') }} —Å—á–∏—Ç–∞—é—Ç—Å—è –ø–æ —Ç–æ–º—É –∂–µ –ø—Ä–∏–Ω—Ü–∏–ø—É, —Ç–æ–ª—å–∫–æ –ø—Ä–∏–±–∞–≤–ª—è–µ—Ç—Å—è –±–æ–ª—å—à–µ –¥–Ω–µ–π.\n   - ¬´–≤ –ø—è—Ç–Ω–∏—Ü—É¬ª ‚Äî –ø–µ—Ä–µ–±–∏—Ä–∞–π –¥–Ω–∏ –≤–ø–µ—Ä—ë–¥ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è –Ω–µ–¥–µ–ª–∏ - `{{ $now.setZone('Europe/Moscow').weekdayLong }}` –¥–æ `–ø—è—Ç–Ω–∏—Ü–∞`. ¬´–Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö¬ª ‚Äî –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–π –∫–∞–∫ –±–ª–∏–∂–∞–π—à—É—é `—Å—É–±–±–æ—Ç–∞` –∏–ª–∏ `–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ`.\n  - ¬´—Å–µ–≥–æ–¥–Ω—è¬ª ‚Äî {{ $now.setZone('Europe/Moscow') }}.\n–ï—Å–ª–∏ –≥–æ–¥ –Ω–µ —É–∫–∞–∑–∞–Ω ‚Äî –ø–æ–¥—Å—Ç–∞–≤—å —Ç–µ–∫—É—â–∏–π - {{ $now.setZone('Europe/Moscow').year }}.\n\nüìç –®–∞–≥ 2 - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–æ—à–µ–¥—à—É—é –¥–∞—Ç—É\n–ò—Å–ø–æ–ª—å–∑—É–π `Get time to date`, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—É—é `inputDate` (–ø–µ—Ä–µ–¥–∞—Ç—å –Ω—É–∂–Ω–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ: 2025-07-22T00:00:00.000+03:00).\n–ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç `-1` ‚Äî –≤–µ—Ä–Ω–∏ –æ—à–∏–±–∫—É:\n{\n   \"status\": \"error\",\n   \"message\": \"–ü–æ—Ö–æ–∂–µ, —ç—Ç–æ –≤—Ä–µ–º—è —É–∂–µ –ø—Ä–æ—à–ª–æ üôà –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π –¥–µ–Ω—å.\"\n}\n\nüìç –®–∞–≥ 3 - –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–Ω—è—Ç—ã—Ö —Å–ª–æ—Ç–æ–≤\n–î–∞–ª–µ–µ –∏—Å–ø–æ–ª—å–∑—É–π `Get notion appointments` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –Ω–∞ —ç—Ç—É –¥–∞—Ç—É. –ó–¥–µ—Å—å —Ç—ã –ø–µ—Ä–µ–¥–∞—ë—à—å –Ω–∞—á–∞–ª—å–Ω—É—é –¥–∞—Ç—É. –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è 24.07: 2025-07-24T00:00:00.000+03:00. –ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞ –±—É–¥–µ—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–µ—Ä–≤–æ–π, –µ—ë –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.\n–ü—Ä–µ–æ–±—Ä–∞–∑—É–π –≤—Ä–µ–º—è –∏–∑ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –≤ —á–∞—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, \"2025-07-27T13:00:51.212+03:00\" ‚Üí \"13:00\"). –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—à–ª–æ—Å—å - –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏ –¥–∞–ª–µ–µ –∫ —à–∞–≥—É 4.\n\nüìç –®–∞–≥ 4 - –°–æ–∑–¥–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤\n–ë–∞–∑–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ —Å–ª–æ—Ç–æ–≤: –æ—Ç `09:00` –¥–æ `20:00` –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ (–ø–æ —á–∞—Å—É) - –≤—Å–µ–≥–æ 12 —Å–ª–æ—Ç–æ–≤.\n–î–∞–ª–µ–µ:\n  1. –£–¥–∞–ª–∏ –∏–∑ –Ω–µ–≥–æ –≤—Å–µ –∑–∞–Ω—è—Ç—ã–µ (—Å—Ä–∞–≤–Ω–∏–≤–∞–π —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ —á–∞—Å–∞).\n  2. –ï—Å–ª–∏ –¥–∞—Ç–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∏—Å–∫–ª—é—á–∏ –≤—Å–µ –ø—Ä–æ—à–µ–¥—à–∏–µ —á–∞—Å—ã, –≤–∫–ª—é—á–∞—è —Ç–µ–∫—É—â–∏–π (–æ—Ä–∏–µ–Ω—Ç–∏—Ä—É–π—Å—è –Ω–∞ —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –ø–æ –ú–°–ö: {{ $now.setZone('Europe/Moscow') }}).\n–ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —Å–µ–π—á–∞—Å 15:20, —Ç–æ —Å–ª–æ—Ç—ã `09:00`, `10:00`, ..., `15:00` ‚Äî —É–∂–µ –ø—Ä–æ—à–ª–∏ –∏ –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω—ã. –ü–µ—Ä–≤—ã–π –≤–æ–∑–º–æ–∂–Ω—ã–π —Å–ª–æ—Ç ‚Äî —Å –Ω–∞—á–∞–ª–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–æ–ª–Ω–æ–≥–æ —á–∞—Å–∞ (`16:00`).\n  3. –ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ –Ω–µ—Ç ‚Äî –≤–µ—Ä–Ω–∏:\n  {\n    \"status\": \"error\",\n    \"message\": \"–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å –±–æ–ª—å—à–µ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ üòî –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π.\"\n  }\n  4. –ò–Ω–∞—á–µ ‚Äî –≤–µ—Ä–Ω–∏ —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä:\n  {\n    \"status\": \"ok\",\n    \"parsed_date\": \"2025-07-25T00:00:00+03:00\",\n    \"available_slots\": [\"10:00\", \"11:00\", \"13:00\", \"14:00\", \"15:00\"]\n  }\n\n‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π C ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∑–∞–ø–∏—Å–∏ –¥–ª—è –æ—Ç–º–µ–Ω—ã\nüìç –®–∞–≥ 1 ‚Äî –†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –∏–∑ inputDate\n(¬´25 –∏—é–ª—è –≤ 15:00¬ª, ¬´21.07 –≤ 10¬ª, –∏ —Ç.–ø.)\n–ï—Å–ª–∏ –Ω–µ —É–¥–∞—ë—Ç—Å—è:\n{\n  \"status\": \"error\",\n  \"message\": \"–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è üôà –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Ç–æ—á–Ω–∏—Ç–µ –≤–≤–æ–¥.\"\n}\nüìç –®–∞–≥ 2 ‚Äî –ü–æ–∏—Å–∫ –∑–∞–ø–∏—Å–∏\n–ü–µ—Ä–µ–¥–∞–π –¥–∞—Ç—É –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ `Check notion appointment` –≤ —Ñ–æ—Ä–º–∞—Ç–µ 2025-07-28T15:00:00+03:00.\nüìç –®–∞–≥ 3 ‚Äî –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞\n–ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ:\n{\n  \"status\": \"ok\",\n  \"appointment_id\": \"fda349dd-e123-4523-bbbb-abc123\",\n  \"appointment_datetime\": \"2025-07-25T15:00:00+03:00\"\n}\n–ï—Å–ª–∏ –Ω–µ—Ç:\n{\n  \"status\": \"error\",\n  \"message\": \"–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∑–∞–ø–∏—Å—å –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è üôà –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–æ–¥.\"\n}\n\n‚ùóÔ∏è‚ùóÔ∏è‚ùóÔ∏è–û–ß–ï–ù–¨ –í–ê–ñ–ù–û:\n‚ùóÔ∏è–û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON. –ù–∏–∫–∞–∫–∏—Ö –ø–æ—è—Å–Ω–µ–Ω–∏–π, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤, Markdown-–±–ª–æ–∫–æ–≤, –∫–∞–≤—ã—á–µ–∫ –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ, –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ –≤–∏–¥–∞ json\\n –∏ –ø—Ä–æ—á–µ–≥–æ."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[1320,220],"id":"2eca52d3-6838-405b-9f22-0e1b4954f5b8","name":"Time slots agent","retryOnFail":false,"maxTries":2,"onError":"continueErrorOutput"},{"parameters":{"inputSource":"jsonExample","jsonExample":"{\n  \"inputDate\": \"a string\",\n  \"sessionId\": \"a string\",\n  \"clientId\": \"a string\",\n  \"actionType\": \"make an appointment\"\n}"},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[880,220],"id":"0496437a-b1cb-45aa-b61c-999a723e99cc","name":"Another workflow trigger"},{"parameters":{"assignments":{"assignments":[{"id":"4f360190-a717-4a93-8336-d03ea65975d5","name":"response","value":"=üòì –ü–æ—Ö–æ–∂–µ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –¥–∞—Ç—ã, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑!","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1860,240],"id":"a4907662-ec2b-4f94-99df-d6a2101e3aea","name":"Send error message"},{"parameters":{"assignments":{"assignments":[{"id":"4f360190-a717-4a93-8336-d03ea65975d5","name":"response","value":"={{ $('Time slots agent').item.json }}","type":"object"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1860,60],"id":"24d605b4-5858-481b-a9ba-904252e7039a","name":"Send message"},{"parameters":{"resource":"databasePage","operation":"getAll","databaseId":{"__rl":true,"value":"23657ae1-e71a-8091-8925-c2337b9b7232","mode":"list","cachedResultName":"–ó–∞–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç–æ–≤","cachedResultUrl":"https://www.notion.so/23657ae1e71a80918925c2337b9b7232"},"returnAll":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}","simple":false,"filterType":"manual","matchType":"allFilters","filters":{"conditions":[{"key":"–°—Ç–∞—Ç—É—Å –≤–∏–∑–∏—Ç–∞|status","condition":"equals","statusValue":"–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ"},{"key":"–ö–ª–∏–µ–Ω—Ç|relation","condition":"contains","relationValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions1_Relation_ID', ``, 'string') }}"}]},"options":{}},"type":"n8n-nodes-base.notionTool","typeVersion":2.2,"position":[1720,560],"id":"403b063b-d42d-4193-bd86-07725ce56a7e","name":"Get client notion appointments","credentials":{"notionApi":{"id":"09WDFf4vp7iD93dG","name":"Notion account VM "}}},{"parameters":{"resource":"databasePage","operation":"getAll","databaseId":{"__rl":true,"value":"23657ae1-e71a-8091-8925-c2337b9b7232","mode":"list","cachedResultName":"–ó–∞–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç–æ–≤","cachedResultUrl":"https://www.notion.so/23657ae1e71a80918925c2337b9b7232"},"returnAll":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Return_All', ``, 'boolean') }}","simple":false,"filterType":"manual","matchType":"allFilters","filters":{"conditions":[{"key":"–î–∞—Ç–∞ –≤–∏–∑–∏—Ç–∞|date","condition":"equals","date":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Date', ``, 'string') }}"}]},"options":{}},"type":"n8n-nodes-base.notionTool","typeVersion":2.2,"position":[1540,560],"id":"bf65627c-0898-478d-b637-c923ce6ca17c","name":"Gheck notion appointment","credentials":{"notionApi":{"id":"09WDFf4vp7iD93dG","name":"Notion account VM "}}},{"parameters":{"assignments":{"assignments":[{"id":"aaaaa079-bc27-4e6a-be5c-c0eb1935cc06","name":"sessionId","value":"=time_slots_{{ $('Another workflow trigger').item.json.sessionId }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1100,220],"id":"5cb947a1-fcd6-45a0-88b0-9e223a6ac967","name":"Set session id"},{"parameters":{"mode":"delete","deleteMode":"all"},"type":"@n8n/n8n-nodes-langchain.memoryManager","typeVersion":1.1,"position":[1060,800],"id":"7bf55ef1-4cb4-4936-9198-46bd68834e59","name":"Chat memory cleaner"},{"parameters":{"sessionIdType":"customKey","sessionKey":"=time_slots_1908115440","contextWindowLength":100},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[980,980],"id":"0c1e1c58-ec03-4634-920b-e1fbc3580e5c","name":"Assistant memory (clear)"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[840,800],"id":"f9a96fc1-7ef6-4a52-8954-64a0a73fd915","name":"When clicking ‚ÄòExecute workflow‚Äô"},{"parameters":{"jsCode":"// –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –≤ –ú–°–ö\nconst now = DateTime.now().setZone('Europe/Moscow');\n\n// –ü–æ–ª—É—á–∞–µ–º –¥–∞—Ç—É –≤–∏–∑–∏—Ç–∞ –∏–∑ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö\nconst visit = DateTime.fromISO(query).setZone('Europe/Moscow');\n\n// –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞–∑–Ω–∏—Ü—É (–µ—Å–ª–∏ –¥–∞—Ç–∞ –≤ –±—É–¥—É—â–µ–º)\nif (visit < now) {\n  return \"-1\";\n}\n\n// –†–∞–∑–Ω–∏—Ü–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö\nconst diff = visit.diff(now, ['days', 'hours', 'minutes']).toObject();\n\n// –û–∫—Ä—É–≥–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è\nconst days = Math.floor(diff.days || 0);\nconst hours = Math.floor(diff.hours || 0);\nconst minutes = Math.floor(diff.minutes || 0);\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞\nlet resultParts = [];\nif (days > 0) resultParts.push(`${days} ${days === 1 ? '–¥–µ–Ω—å' : (days < 5 ? '–¥–Ω—è' : '–¥–Ω–µ–π')}`);\nif (hours > 0) resultParts.push(`${hours} ${hours === 1 ? '—á–∞—Å' : (hours < 5 ? '—á–∞—Å–∞' : '—á–∞—Å–æ–≤')}`);\nif (minutes > 0) resultParts.push(`${minutes} ${minutes === 1 ? '–º–∏–Ω—É—Ç–∞' : (minutes < 5 ? '–º–∏–Ω—É—Ç—ã' : '–º–∏–Ω—É—Ç')}`);\n\nconst resultString = resultParts.join(', ');\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç\nreturn resultString"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.2,"position":[1880,560],"id":"2021b2a8-2b1b-4e40-9c39-2a849324b3c7","name":"Get time to date","executeOnce":false},{"parameters":{"contextWindowLength":100},"id":"60158d6a-9287-4172-b104-4000d5b09d83","name":"Assistant memory","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.2,"position":[1220,560]}],"connections":{"OpenAI chat model":{"ai_languageModel":[[{"node":"Time slots agent","type":"ai_languageModel","index":0}]]},"Get notion appointments":{"ai_tool":[[{"node":"Time slots agent","type":"ai_tool","index":0}]]},"Time slots agent":{"main":[[{"node":"Send message","type":"main","index":0}],[{"node":"Send error message","type":"main","index":0}]]},"Another workflow trigger":{"main":[[{"node":"Set session id","type":"main","index":0}]]},"Get client notion appointments":{"ai_tool":[[{"node":"Time slots agent","type":"ai_tool","index":0}]]},"Gheck notion appointment":{"ai_tool":[[{"node":"Time slots agent","type":"ai_tool","index":0}]]},"Set session id":{"main":[[{"node":"Time slots agent","type":"main","index":0}]]},"Assistant memory (clear)":{"ai_memory":[[{"node":"Chat memory cleaner","type":"ai_memory","index":0}]]},"When clicking ‚ÄòExecute workflow‚Äô":{"main":[[{"node":"Chat memory cleaner","type":"main","index":0}]]},"Get time to date":{"ai_tool":[[{"node":"Time slots agent","type":"ai_tool","index":0}]]},"Assistant memory":{"ai_memory":[[{"node":"Time slots agent","type":"ai_memory","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"ae6015af-fb2a-4b7e-9e47-87624e817dae","triggerCount":0,"tags":[{"createdAt":"2025-07-21T12:00:12.966Z","updatedAt":"2025-07-21T12:00:12.966Z","id":"SE2p7A4ZzY3fduaR","name":"vmb"}]}