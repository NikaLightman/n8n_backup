{"createdAt":"2025-07-31T22:23:21.867Z","updatedAt":"2025-08-01T18:12:56.000Z","id":"di8kBZ5wVZDwFClK","name":"My workflow 2","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-260,0],"id":"61d3b4d7-265c-42e1-b1ca-06a6438076a0","name":"When clicking ‚ÄòExecute workflow‚Äô","disabled":true},{"parameters":{"language":"python","pythonCode":"import asyncio\nfrom telethon import TelegramClient\nimport os\n\n# --- –í–ê–®–ò –î–ê–ù–ù–´–ï ---\napi_id = 25696470\napi_hash = 'f673c6450e9471ed08d19e0422db89fe\n# ------------------------------------\n\n# --- –ü–ê–†–ê–ú–ï–¢–†–´ –î–õ–Ø –ò–°–¢–û–†–ò–ò ---\n# –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å–µ—Å—Å–∏–∏, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Å–æ–∑–¥–∞–ª–∏ —Ä–∞–Ω–µ–µ.\nsession_file = '/root/n8n_telegram.session'\n# –ü—É—Ç—å –∫ –∫–∞—Ä—Ç–∏–Ω–∫–µ –∏–ª–∏ –≤–∏–¥–µ–æ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.\nfile_path = '/root/test_story.jpg' # –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç—Ç–æ—Ç —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!\n# –¢–µ–∫—Å—Ç –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏.\ncaption = \"–¢–µ—Å—Ç–æ–≤–∞—è –∏—Å—Ç–æ—Ä–∏—è –∏–∑ n8n! üöÄ\"\n# ------------------------------------\n\n# –û—Å–Ω–æ–≤–Ω–∞—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è\nasync def post_story():\n# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ñ–∞–π–ª —Å–µ—Å—Å–∏–∏. –ï—Å–ª–∏ –Ω–µ—Ç - –≤—ã—Ö–æ–¥–∏–º —Å –æ—à–∏–±–∫–æ–π.\n  if not os.path.exists(session_file):\n    return {\"status\": \"error\", \"message\": f\"–§–∞–π–ª —Å–µ—Å—Å–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω: {session_file}. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–∞—á–∞–ª–∞ —Å–∫—Ä–∏–ø—Ç telegram_login.py –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.\"}\n\n# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ñ–∞–π–ª –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏.\n  if not os.path.exists(file_path):\n    return {\"status\": \"error\", \"message\": f\"–§–∞–π–ª –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}\"}\n\n  client = TelegramClient(session_file, api_id, api_hash)\n  \n  try:\n    await client.connect()\n    # –ï—Å–ª–∏ –º—ã –¥–æ—à–ª–∏ —Å—é–¥–∞, –∑–Ω–∞—á–∏—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ñ–∞–π–ª —Å–µ—Å—Å–∏–∏ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ.\n\n    result = await client.send_file(\n        'me',\n        file_path,\n        caption=caption,\n        is_story=True\n    )\n    return {\"status\": \"success\", \"story_id\": result.id, \"message\": \"–ò—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞!\"}\n  except Exception as e:\n      return {\"status\": \"error\", \"message\": str(e)}\n  finally:\n    if client.is_connected():\n      await client.disconnect()\n\n  # –ó–∞–ø—É—Å–∫–∞–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é\n  loop = asyncio.get_event_loop()\n  result_data = loop.run_until_complete(post_story())\n\n  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ n8n\n  return [{'json': result_data}]\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-40,0],"id":"5a4a0a0c-06ef-48bf-84ac-a2ef12410f17","name":"Code","disabled":true},{"parameters":{"method":"POST","url":"https://api.telegram.org/bot8065402889:AAH1KAlPnodI3n_nHGw-X8PEnDj98CIQHTs/postStory","sendQuery":true,"specifyQuery":"json","jsonQuery":"={\n  \"business_connection_id\": \"rRphMXzHaUiaEAAAT_5vL_MbBmw\",\n  \"content\": {\n    \"type\": \"video\",\n    \"video\": \"CgACAgQAAyEGAASofS4ZAAMlaIveqxcAAUujDG-YOn_ivu-TE-4_AAIMCQACZ3VlUOjR-obOdTOCNgQ\"\n  },\n  \"active_period\": 86400,\n  \"caption\": \"‚úî –ú–æ—è –∏—Å—Ç–æ—Ä–∏—è –æ—Ç –±–∏–∑–Ω–µ—Å‚Äë–∞–∫–∫–∞—É–Ω—Ç–∞\"\n}\n","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"multipart/form-data"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[340,180],"id":"c19fc626-f3b1-4505-b33b-2928e4beca96","name":"HTTP Request"},{"parameters":{"updates":["*"],"additionalFields":{}},"type":"n8n-nodes-base.telegramTrigger","typeVersion":1.2,"position":[120,180],"id":"4e09008b-c4a4-4825-b130-77a7551c08eb","name":"Telegram Trigger","webhookId":"9c45b95e-a94c-4a68-9108-76f623b218b3","credentials":{"telegramApi":{"id":"QvLj73P2usDhUSBY","name":"VM_–ü–æ—Å—Ç–∏–Ω–≥_–¢–ì_–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç"}}},{"parameters":{"language":"python","pythonCode":"import requests\nimport json\n\n# === –¢–≤–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ===\nTOKEN = \"8065402889:AAH1KAlPnodI3n_nHGw-X8PEnDj98CIQHTs\"  # –í–°–¢–ê–í–¨ —Å–≤–æ–π —Ç–æ–∫–µ–Ω\nBUSINESS_ID = \"rRphMXzHaUiaEAAAT_5vL_MbBmw\"\nVIDEO_FILE_ID = \"CgACAgQAAyEGAASofS4ZAAMlaIveqxcAAUujDG-YOn_ivu-TE-4_AAIMCQACZ3VlUOjR-obOdTOCNgQ\"\nCAPTION = \"‚úî –ú–æ—è –∏—Å—Ç–æ—Ä–∏—è –æ—Ç –±–∏–∑–Ω–µ—Å‚Äë–∞–∫–∫–∞—É–Ω—Ç–∞\"\n\n# === API URL ===\nurl = f\"https://api.telegram.org/bot{TOKEN}/postStory\"\n\n# === Content –¥–ª—è video story ===\ncontent = {\n    \"type\": \"video\",\n    \"video\": VIDEO_FILE_ID\n}\n\n# === –°–±–æ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ ===\ndata = {\n    \"business_connection_id\": BUSINESS_ID,\n    \"active_period\": 86400,\n    \"caption\": CAPTION,\n    \"content\": json.dumps(content)\n}\n\n# === –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ ===\nresponse = requests.post(url, data=data)\n\n# === –†–µ–∑—É–ª—å—Ç–∞—Ç ===\nprint(\"Status:\", response.status_code)\nprint(\"Response:\", response.json())\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-40,340],"id":"eb78a74f-6a77-495c-bdfa-18f3dcce1deb","name":"Code1"}],"connections":{"When clicking ‚ÄòExecute workflow‚Äô":{"main":[[{"node":"Code","type":"main","index":0}]]},"Telegram Trigger":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"1b8205df-720f-491e-94f5-dcd859dcfbfb","triggerCount":1,"tags":[]}